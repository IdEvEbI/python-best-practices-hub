# Git 工作流程指南

> 本文档详细介绍项目的 Git 工作流程，包括功能开发、版本发布和紧急修复的具体操作步骤。

## 1. 功能开发流程

**设计目标**：在保证代码质量的前提下，最大化开发效率，支持并行开发和快速迭代。

**核心原则**：

- 🔄 **持续集成**：频繁合并，减少冲突
- 🧪 **测试驱动**：先写测试，再写实现
- 📋 **小步快跑**：小功能，频繁提交
- 🔍 **质量优先**：质量检查不妥协

### 1.1 创建功能分支

**目的**：为每个功能创建独立的开发环境，避免相互干扰。

**技术原理**：

- 🌿 **分支隔离**：每个功能在独立分支中开发
- 🔄 **基于最新代码**：从 develop 分支创建，确保包含最新变更
- 📡 **远程同步**：推送到远程，支持团队协作

```bash
# 从 develop 分支创建新功能分支
git checkout develop
git pull origin develop
git checkout -b feature/user-authentication

# 推送新分支到远程
git push -u origin feature/user-authentication
```

**预期效果**：

- ✅ 获得最新的代码基础
- ✅ 创建独立的功能开发环境
- ✅ 支持团队协作和代码审查

### 1.2 开发与提交

**目的**：在功能分支中进行开发，保持提交历史的清晰和可追溯。

**技术原理**：

- 📝 **原子提交**：每个提交只做一件事
- 🔄 **定期同步**：避免与主分支差异过大
- 📋 **规范提交**：使用 Conventional Commits 规范

```bash
# 开发过程中定期提交
git add .
git commit -m "feat: add user login validation"

# 定期同步主分支变更
git checkout develop
git pull origin develop
git checkout feature/user-authentication
git rebase develop
```

**预期效果**：

- ✅ 保持提交历史的清晰性
- ✅ 减少合并冲突
- ✅ 便于代码审查和问题定位

### 1.3 创建 Pull Request

**目的**：通过 PR 机制进行代码审查，确保代码质量和团队协作。

**技术原理**：

- 🔍 **代码审查**：人工检查代码质量和逻辑
- 🤖 **自动化检查**：CI/CD 自动运行测试和检查
- 💬 **协作讨论**：在 PR 中进行技术讨论

```bash
# 推送最终代码
git push origin feature/user-authentication

# 在 GitHub 上创建 PR：
# 从 feature/user-authentication 到 develop
```

**预期效果**：

- ✅ 触发自动化测试和检查
- ✅ 启动代码审查流程
- ✅ 记录开发过程和决策

### 1.4 代码审查与合并

**目的**：通过多层次的检查确保代码质量，然后安全地合并到主分支。

**技术原理**：

- 👥 **多人审查**：不同角度的代码检查
- 🤖 **自动化验证**：CI/CD 确保质量
- 🔒 **保护机制**：分支保护规则强制执行

**审查流程**：

1. **自动化检查**：CI/CD 运行所有测试和检查
2. **人工审查**：团队成员检查代码逻辑和设计
3. **问题修复**：根据反馈修改代码
4. **最终合并**：所有检查通过后合并
5. **分支清理**：删除已完成的功能分支

**预期效果**：

- ✅ 确保代码质量和功能正确性
- ✅ 提高团队技术水平和知识共享
- ✅ 保持主分支的稳定性

## 2. 版本发布流程

**设计目标**：在保证发布质量的前提下，实现版本的可控发布和快速回滚，确保生产环境的稳定性。

**核心问题**：

- ⚠️ **发布风险**：如何确保发布版本的质量和稳定性？
- ⚠️ **版本管理**：如何清晰地标记和管理不同版本？
- ⚠️ **回滚机制**：如何在出现问题时快速回滚？
- ⚠️ **团队协作**：如何协调开发、测试、发布流程？

**技术原理**：

- 🔒 **版本冻结**：在 release 分支中冻结功能，专注测试和修复
- 🏷️ **标签管理**：通过 Git 标签和 GitHub Release 管理版本
- 🔄 **分支同步**：确保 develop 分支包含所有发布内容
- 📋 **质量门禁**：通过 PR 和审查确保发布质量

### 2.1 创建发布分支

**目的**：为即将发布的版本创建独立的测试和准备环境，避免影响正在进行的开发工作。

**技术原理**：

- 🌿 **分支隔离**：创建独立的发布分支，不影响 develop 分支的持续开发
- 🔄 **基于稳定代码**：从 develop 分支创建，确保包含所有已开发的功能
- 📡 **团队协作**：推送到远程，支持团队协作和审查

```bash
# 从 develop 分支创建发布分支
git checkout develop
git pull origin develop
git checkout -b release/v1.0.0
git push -u origin release/v1.0.0
```

**预期效果**：

- ✅ 创建独立的发布测试环境
- ✅ 不影响正在进行的开发工作
- ✅ 支持团队协作和审查

### 2.2 发布准备

**目的**：在发布分支中进行版本相关的准备工作，确保发布版本的完整性和一致性。

**技术原理**：

- 📝 **版本标记**：更新版本号，确保版本信息的一致性
- 📚 **文档同步**：更新变更日志，记录新功能和修复
- 🧪 **质量验证**：进行最终测试，确保发布质量
- 📋 **原子提交**：将所有发布准备作为一个完整的提交

```bash
# 更新版本号
# 更新 CHANGELOG.md
# 进行最终测试

git add .
git commit -m "chore: prepare release v1.0.0"
git push origin release/v1.0.0
```

**预期效果**：

- ✅ 版本信息完整一致
- ✅ 变更记录清晰可追溯
- ✅ 发布质量得到验证

### 2.3 合并到主分支并创建 Release

**目的**：将经过验证的发布版本合并到生产分支，并创建正式的版本发布。

**技术原理**：

- 🔍 **质量审查**：通过 PR 机制进行最终的质量审查
- 🏷️ **版本标记**：通过 GitHub Release 创建正式的版本标记
- 📦 **发布管理**：支持发布文件上传和分发
- 🔗 **永久链接**：提供稳定的版本下载链接

```bash
# 创建 PR：从 release/v1.0.0 到 main
# 审查通过后合并

# 在 GitHub 上创建 Release（推荐方式）
# 1. 在 GitHub 仓库页面点击 "Releases"
# 2. 点击 "Create a new release"
# 3. 选择标签：v1.0.0
# 4. 填写 Release 标题和描述
# 5. 上传发布文件（可选）
# 6. 点击 "Publish release"
```

**预期效果**：

- ✅ 生产环境获得稳定的发布版本
- ✅ 创建正式的版本发布记录
- ✅ 支持版本下载和分发

### 2.4 同步回开发分支

**目的**：确保开发分支包含所有发布内容，为下一轮开发做好准备。

**技术原理**：

- 🔄 **分支同步**：将 main 分支的变更合并回 develop 分支
- 📋 **历史一致性**：确保所有分支的历史记录一致
- 🚀 **持续开发**：为下一轮功能开发做好准备

```bash
# 将 main 分支的变更合并回 develop
git checkout develop
git merge main
git push origin develop
```

**预期效果**：

- ✅ 开发分支包含所有发布内容
- ✅ 分支历史记录保持一致
- ✅ 为下一轮开发做好准备

## 3. 紧急修复流程

**设计目标**：在出现生产环境紧急问题时，能够快速响应、修复并部署，最小化对用户的影响。

**核心问题**：

- ⚠️ **时间压力**：如何在最短时间内修复生产问题？
- ⚠️ **质量保证**：如何在快速修复的同时保证质量？
- ⚠️ **影响控制**：如何最小化修复过程对系统的影响？
- ⚠️ **流程简化**：如何绕过正常的开发流程进行紧急修复？

**技术原理**：

- 🚀 **绕过正常流程**：直接从 main 分支创建修复分支，跳过 develop 分支
- ⚡ **快速审查**：简化审查流程，专注于关键问题
- 🔄 **双向合并**：同时合并到 main 和 develop 分支
- 📋 **事后完善**：修复后补充测试和文档

### 3.1 创建热修复分支

**目的**：为紧急修复创建独立的工作环境，基于生产环境的稳定代码进行修复。

**技术原理**：

- 🌿 **基于生产代码**：从 main 分支创建，确保基于稳定的生产环境
- 🔄 **最新状态**：拉取最新的 main 分支代码，确保修复基于最新状态
- 📡 **快速协作**：推送到远程，支持团队快速协作

```bash
# 从 main 分支创建热修复分支
git checkout main
git pull origin main
git checkout -b hotfix/critical-security-fix
git push -u origin hotfix/critical-security-fix
```

**预期效果**：

- ✅ 基于稳定的生产环境代码
- ✅ 创建独立的紧急修复环境
- ✅ 支持团队快速协作

### 3.2 快速修复

**目的**：在热修复分支中进行最小化的修复，专注于解决核心问题。

**技术原理**：

- 🎯 **最小化修改**：只修改必要的代码，避免引入新问题
- 📝 **清晰提交**：使用规范的提交消息，便于后续追踪
- ⚡ **快速验证**：进行基本的验证，确保修复有效

```bash
# 进行紧急修复
git add .
git commit -m "fix: resolve critical security vulnerability"
git push origin hotfix/critical-security-fix
```

**预期效果**：

- ✅ 问题得到快速修复
- ✅ 修改记录清晰可追溯
- ✅ 为后续审查做好准备

### 3.3 紧急合并

**目的**：将修复快速部署到生产环境，同时确保开发分支也包含修复内容。

**技术原理**：

- 🔍 **快速审查**：简化审查流程，专注于修复的正确性
- 🔄 **双向合并**：同时合并到 main 和 develop 分支
- 📋 **流程记录**：记录紧急修复的过程和决策

```bash
# 创建 PR：从 hotfix/critical-security-fix 到 main
# 快速审查和合并
# 同时合并到 develop 分支
```

**预期效果**：

- ✅ 生产环境问题得到快速解决
- ✅ 开发分支包含修复内容
- ✅ 为后续完善修复做好准备

---

> **一句话总结**：本项目的工作流程支持功能开发、版本发布和紧急修复三种场景，通过标准化的操作步骤确保代码质量和团队协作效率。更多配置细节请参考 [GitHub 配置](./003-github-config.md)。
